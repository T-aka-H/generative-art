<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <title>a.g.r</title>
  <link rel="icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      background: #000;
      color: #fff;
      width: 100%; height: 100%;
      font-family: Georgia, 'Times New Roman', serif;
      overflow-x: hidden;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    header {
      padding: 80px 0 60px;
      text-align: center;
    }
    header h1 {
      font-size: 14px;
      font-weight: 400;
      letter-spacing: 10px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.35);
    }
    .gallery {
      display: flex;
      flex-direction: column;
      gap: 60px;
      padding: 0 24px 80px;
      max-width: 800px;
      width: 100%;
    }
    .work {
      display: block;
      text-decoration: none;
      color: inherit;
      position: relative;
      border: 1px solid rgba(255,255,255,0.08);
      transition: border-color 0.5s ease;
    }
    .work:hover {
      border-color: rgba(255,255,255,0.25);
    }
    .work-preview {
      width: 100%;
      aspect-ratio: 16 / 9;
      overflow: hidden;
      position: relative;
      background: #080808;
    }
    .work-preview canvas {
      width: 100%; height: 100%;
      display: block;
    }
    .work-info {
      padding: 24px 28px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }
    .work-title {
      font-size: 20px;
      letter-spacing: 8px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.8);
      transition: color 0.3s;
    }
    .work:hover .work-title { color: #fff; }
    .work-sub {
      font-size: 12px;
      letter-spacing: 3px;
      color: rgba(255,255,255,0.25);
      font-family: -apple-system, sans-serif;
    }
    footer {
      padding: 40px 0;
      text-align: center;
      color: rgba(255,255,255,0.15);
      font-size: 11px;
      letter-spacing: 3px;
      font-family: -apple-system, sans-serif;
    }
    @media (max-width: 600px) {
      header { padding: 50px 0 40px; }
      header h1 { font-size: 12px; letter-spacing: 8px; }
      .gallery { gap: 40px; padding: 0 16px 60px; }
      .work-info { padding: 18px 20px; }
      .work-title { font-size: 16px; letter-spacing: 6px; }
      .work-sub { font-size: 10px; }
    }
    /* Branding splash — white, matches native iOS */
    #loadingOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #fff;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      transition: opacity 1.2s ease-in;
    }
    #loadingOverlay.fade-out {
      opacity: 0;
      pointer-events: none;
    }
    .branding-title {
      font-size: 20px;
      font-weight: 400;
      letter-spacing: 12px;
      color: #000;
      font-family: Georgia, 'Times New Roman', serif;
      opacity: 0;
      animation: brandFadeIn 1.0s 0.3s ease-out forwards;
    }
    .branding-sub {
      font-size: 11px;
      font-weight: 400;
      letter-spacing: 6px;
      color: #000;
      font-family: Georgia, 'Times New Roman', serif;
      margin-top: 12px;
      opacity: 0;
      animation: brandSubFadeIn 1.0s 0.8s ease-out forwards;
    }
    @keyframes brandFadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes brandSubFadeIn {
      0% { opacity: 0; }
      100% { opacity: 0.35; }
    }
  </style>
</head>
<body>
  <div id="loadingOverlay">
    <div class="branding-title">ART-GO-RHYTHM</div>
    <div class="branding-sub" style="opacity:0">a.g.r</div>
  </div>
  <header>
    <h1>ART-GO-RHYTHM</h1>
    <p style="font-size:12px;letter-spacing:6px;color:rgba(255,255,255,0.2);margin-top:10px">a.g.r</p>
    <a href="./about.html" style="display:inline-block;margin-top:16px;color:rgba(255,255,255,0.18);text-decoration:none;font-size:10px;letter-spacing:3px;font-family:-apple-system,sans-serif;transition:color 0.3s" onmouseover="this.style.color='rgba(255,255,255,0.45)'" onmouseout="this.style.color='rgba(255,255,255,0.18)'">ABOUT</a>
  </header>
  <div class="gallery">
    <a href="./waves/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvWaves"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Waves</span>
        <span class="work-sub">Interactive Ocean</span>
      </div>
    </a>
    <a href="./aurora/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvAurora"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Aurora</span>
        <span class="work-sub">Mosaic of Light</span>
      </div>
    </a>
    <a href="./meadow/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvMeadow"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Meadow</span>
        <span class="work-sub">Breeze and Light</span>
      </div>
    </a>
    <a href="./clouds/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvClouds"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Clouds</span>
        <span class="work-sub">Drifting Forms</span>
      </div>
    </a>
    <a href="./snow/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvSnow"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Snow</span>
        <span class="work-sub">Falling Light</span>
      </div>
    </a>
    <a href="./neon1/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvNeon"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Neon1</span>
        <span class="work-sub">Skating Light</span>
      </div>
    </a>
    <a href="./neon2/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvNeon2"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Neon2</span>
        <span class="work-sub">Triangle Light</span>
      </div>
    </a>
    <a href="./neon3/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvNeon3"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Neon3</span>
        <span class="work-sub">Shape Shifting</span>
      </div>
    </a>
    <a href="./neon4/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvNeon4"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Neon4</span>
        <span class="work-sub">Grid Light</span>
      </div>
    </a>
    <a href="./neon5/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvNeon5"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Neon5</span>
        <span class="work-sub">Trig Waves</span>
      </div>
    </a>
    <a href="./neon6/index.html" class="work">
      <div class="work-preview">
        <canvas id="cvNeon6"></canvas>
      </div>
      <div class="work-info">
        <span class="work-title">Neon6</span>
        <span class="work-sub">Orbital</span>
      </div>
    </a>
  </div>
  <div style="text-align:center;padding:0 0 20px">
    <a href="./math.html" style="display:inline-block;color:rgba(255,255,255,0.35);text-decoration:none;font-size:10px;letter-spacing:3px;font-family:-apple-system,sans-serif;transition:color 0.3s" onmouseover="this.style.color='rgba(255,255,255,0.6)'" onmouseout="this.style.color='rgba(255,255,255,0.35)'">THE "ART-GO-RHYTHM" BEHIND</a>
  </div>
  <footer>
    tap a work to enter
  </footer>

  <script>
  // === Branding splash — 3 seconds then fade ===
  var _loadingDone = false;
  function dismissLoading() {
    if (_loadingDone) return;
    _loadingDone = true;
    var ov = document.getElementById('loadingOverlay');
    if (ov) {
      ov.classList.add('fade-out');
      setTimeout(function() { if (ov.parentNode) ov.parentNode.removeChild(ov); }, 1300);
    }
  }
  setTimeout(dismissLoading, 3000);

  // === Noise utilities ===
  function hash2(ix,iy){var n=Math.sin(ix*127.1+iy*311.7)*43758.5453;return n-Math.floor(n)}
  function vnoise(x,y){var ix=Math.floor(x),iy=Math.floor(y),fx=x-ix,fy=y-iy;fx=fx*fx*(3-2*fx);fy=fy*fy*(3-2*fy);var a=hash2(ix,iy),b=hash2(ix+1,iy),c=hash2(ix,iy+1),d=hash2(ix+1,iy+1);return a+(b-a)*fx+(c-a)*fy+(a-b-c+d)*fx*fy}
  function vnoise3(x,y,z){var iz=Math.floor(z),fz=z-iz;fz=fz*fz*(3-2*fz);return vnoise(x+iz*17.3,y+iz*31.7)*(1-fz)+vnoise(x+(iz+1)*17.3,y+(iz+1)*31.7)*fz}
  function pnoise(a,b){return(Math.sin(a*12.9898+b*78.233)*43758.5453)%1}
  function snoise(seed,t){var i=Math.floor(t),f=t-i;f=f*f*(3-2*f);return pnoise(seed,i)*(1-f)+pnoise(seed,i+1)*f}
  function rndNeon(){var h=Math.random()*360,s=0.8+Math.random()*0.2;var c=s,x=c*(1-Math.abs((h/60)%2-1));var r1,g1,b1;if(h<60){r1=c;g1=x;b1=0}else if(h<120){r1=x;g1=c;b1=0}else if(h<180){r1=0;g1=c;b1=x}else if(h<240){r1=0;g1=x;b1=c}else if(h<300){r1=x;g1=0;b1=c}else{r1=c;g1=0;b1=x}return Math.round((r1+(1-s))*255)+','+Math.round((g1+(1-s))*255)+','+Math.round((b1+(1-s))*255)}

  // === Lazy init via IntersectionObserver — static draw-once previews ===
  var initDone = {};
  var observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(e) {
      if (e.isIntersecting && !initDone[e.target.id]) {
        initDone[e.target.id] = true;
        drawPreview(e.target.id);
        dismissLoading();
      }
    });
  }, { threshold: 0.05, rootMargin: '200px 0px' });
  ['cvWaves','cvAurora','cvMeadow','cvClouds','cvSnow','cvNeon','cvNeon2','cvNeon3','cvNeon4','cvNeon5','cvNeon6'].forEach(function(id) {
    var el = document.getElementById(id);
    if (el) observer.observe(el);
  });
  var PFN = {};
  function drawPreview(id) { if (PFN[id]) PFN[id](); }

  // === Waves (static) ===
  PFN.cvWaves = function() {
    var cv = document.getElementById('cvWaves'), ctx = cv.getContext('2d');
    var W = cv.width = 400, H = cv.height = 225, t = 3.0;
    ctx.fillStyle = '#00000f'; ctx.fillRect(0,0,W,H);
    for (var layer = 0; layer < 8; layer++) {
      var yBase = H*0.3 + layer*H*0.08;
      var hue = 200 + layer*8 + Math.sin(t*0.3+layer)*15;
      ctx.beginPath(); ctx.moveTo(0,H);
      for (var x = 0; x <= W; x += 4) {
        ctx.lineTo(x, yBase + Math.sin(x*0.015+t*0.5+layer*0.8)*12 + Math.sin(x*0.008+t*0.3-layer*0.5)*8 + Math.sin(x*0.025+t*0.7+layer*1.2)*4);
      }
      ctx.lineTo(W,H); ctx.closePath();
      ctx.fillStyle = 'hsla('+hue+',40%,'+(15+layer*4)+'%,'+(0.12+layer*0.03)+')'; ctx.fill();
    }
  };

  // === Aurora (static mosaic) ===
  PFN.cvAurora = function() {
    var cv = document.getElementById('cvAurora'), ctx = cv.getContext('2d');
    var W = cv.width = 400, H = cv.height = 225, dot = 4, t = 2.0;
    var cols = Math.ceil(W/dot), rows = Math.ceil(H/dot);
    var hues = [240,270,310,200,160,120,280,350];
    for (var r = 0; r < rows; r++) for (var c = 0; c < cols; c++) {
      var gx=c*dot, gy=r*dot;
      var wx=gx+vnoise3(gx*0.008,gy*0.008,t*0.4)*60-30, wy=gy+vnoise3(gx*0.008+5,gy*0.008+5,t*0.4)*60-30;
      var ci=vnoise3(wx*0.005,wy*0.005,t*0.5)*8, c0=Math.floor(ci)%8, c1=(c0+1)%8, fr=ci-Math.floor(ci);
      var h=hues[c0]+(hues[c1]-hues[c0])*fr+vnoise3(wx*0.004+10,wy*0.01+10,t*0.3)*60-30;
      h=((h%360)+360)%360;
      var bn=vnoise3(wx*0.005+20,wy*0.01+20,t*0.4);
      ctx.fillStyle='hsl('+h+','+(45+bn*30)+'%,'+(12+bn*28)+'%)'; ctx.fillRect(gx,gy,dot,dot);
    }
  };

  // === Meadow (static mosaic) ===
  PFN.cvMeadow = function() {
    var cv = document.getElementById('cvMeadow'), ctx = cv.getContext('2d');
    var W = cv.width = 400, H = cv.height = 225, dot = 4, t = 2.0;
    var cols = Math.ceil(W/dot), rows = Math.ceil(H/dot);
    var hues = [128,162,110,172,120,155,105,148];
    for (var r = 0; r < rows; r++) for (var c = 0; c < cols; c++) {
      var gx=c*dot, gy=r*dot;
      var wx=gx+vnoise3(gx*0.006,gy*0.008,t*0.15)*70-35, wy=gy+vnoise3(gx*0.006+5,gy*0.008+5,t*0.15)*70-35;
      var ci=vnoise3(wx*0.005,wy*0.006,t*0.08)*8, c0=Math.floor(ci)%8, c1=(c0+1)%8, fr=ci-Math.floor(ci);
      var h=hues[c0]+(hues[c1]-hues[c0])*fr+vnoise3(wx*0.004+10,wy*0.01+10,t*0.1)*30-15;
      h=((h%360)+360)%360;
      var bn=vnoise3(wx*0.005+20,wy*0.01+20,t*0.06);
      ctx.fillStyle='hsl('+h+','+(45+bn*25)+'%,'+(12+bn*28)+'%)'; ctx.fillRect(gx,gy,dot,dot);
    }
  };

  // === Clouds (static mosaic) ===
  PFN.cvClouds = function() {
    var cv = document.getElementById('cvClouds'), ctx = cv.getContext('2d');
    var W = cv.width = 400, H = cv.height = 225, dot = 4, t = 2.0;
    var cols = Math.ceil(W/dot), rows = Math.ceil(H/dot);
    var hues = [210,220,200,230,190,240,35,215];
    for (var r = 0; r < rows; r++) for (var c = 0; c < cols; c++) {
      var gx=c*dot, gy=r*dot;
      var wx=gx+vnoise3(gx*0.006,gy*0.006,t*0.3)*80-40, wy=gy+vnoise3(gx*0.006+5,gy*0.006+5,t*0.3)*80-40;
      var d1=vnoise3(wx*0.004,wy*0.004,t*0.2), d2=vnoise3(wx*0.012,wy*0.012,t*0.4)*0.5, d3=vnoise3(wx*0.03,wy*0.03,t*0.6)*0.25;
      var raw=d1+d2+d3, st=(raw-0.35)/0.6; st=st<0?0:(st>1?1:st); var density=st*st*(3-2*st);
      var ci=vnoise3(wx*0.005,wy*0.005,t*0.5)*8, c0=Math.floor(ci)%8, c1=(c0+1)%8, fr=ci-Math.floor(ci);
      var h=hues[c0]+(hues[c1]-hues[c0])*fr+vnoise3(wx*0.004+10,wy*0.01+10,t*0.3)*40-20;
      h=((h%360)+360)%360;
      var s=12+vnoise3(wx*0.005+20,wy*0.01+20,t*0.4)*18, l=15+density*40;
      if(density>0.7){var core=(density-0.7)/0.3;s*=(1-core*0.5);l+=core*10}
      ctx.fillStyle='hsl('+h+','+s+'%,'+l+'%)'; ctx.fillRect(gx,gy,dot,dot);
    }
  };

  // === Snow (static particles) ===
  PFN.cvSnow = function() {
    var cv = document.getElementById('cvSnow'), ctx = cv.getContext('2d');
    var W = cv.width = 400, H = cv.height = 225;
    ctx.fillStyle='#00020a'; ctx.fillRect(0,0,W,H);
    for (var i = 0; i < 35; i++) {
      var x=Math.random()*W, y=Math.random()*H, size=3+Math.random()*20, alpha=0.05+Math.random()*0.15;
      var g=ctx.createRadialGradient(x,y,0,x,y,size);
      g.addColorStop(0,'rgba(200,210,255,'+alpha+')'); g.addColorStop(0.5,'rgba(200,210,255,'+(alpha*0.3)+')'); g.addColorStop(1,'rgba(200,210,255,0)');
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,size,0,Math.PI*2); ctx.fill();
    }
  };

  // === Neon trail helper — simulate N steps, draw all trails at once ===
  function edgeSteer(s,W,H,th) {
    var ex=Math.abs(s.x-W/2)/(W/2), ey=Math.abs(s.y-H/2)/(H/2), edge=Math.max(ex,ey);
    if (edge > th) {
      var da=Math.atan2(H/2-s.y,W/2-s.x)-s.angle;
      while(da>Math.PI)da-=Math.PI*2; while(da<-Math.PI)da+=Math.PI*2;
      s.angle+=da*(edge-th)*0.4; return true;
    }
    return false;
  }
  function neonTrails(canvasId, skaters, stepFn, steps) {
    var cv = document.getElementById(canvasId); if(!cv) return;
    var ctx = cv.getContext('2d'), W = cv.width = 400, H = cv.height = 225;
    ctx.fillStyle='#020008'; ctx.fillRect(0,0,W,H);
    ctx.globalCompositeOperation='lighter'; ctx.lineCap='round';
    for (var step = 0; step < steps; step++) {
      var t = step*0.008, fade = Math.min(1,step/15);
      for (var si = 0; si < skaters.length; si++) {
        var s = skaters[si]; s.px=s.x; s.py=s.y;
        stepFn(s,t,W,H,step);
        ctx.strokeStyle='rgba('+s.col+','+(0.025*fade)+')'; ctx.lineWidth=6;
        ctx.beginPath(); ctx.moveTo(s.px,s.py); ctx.lineTo(s.x,s.y); ctx.stroke();
        ctx.strokeStyle='rgba('+s.col+','+(0.07*fade)+')'; ctx.lineWidth=2.5;
        ctx.beginPath(); ctx.moveTo(s.px,s.py); ctx.lineTo(s.x,s.y); ctx.stroke();
        ctx.strokeStyle='rgba('+s.col+','+(0.14*fade)+')'; ctx.lineWidth=0.8;
        ctx.beginPath(); ctx.moveTo(s.px,s.py); ctx.lineTo(s.x,s.y); ctx.stroke();
      }
    }
    for (var si = 0; si < skaters.length; si++) {
      var s = skaters[si];
      ctx.fillStyle='rgba('+s.col+',0.12)'; ctx.beginPath(); ctx.arc(s.x,s.y,5,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='rgba('+s.col+',0.3)'; ctx.beginPath(); ctx.arc(s.x,s.y,2.5,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='rgba(255,240,255,0.6)'; ctx.beginPath(); ctx.arc(s.x,s.y,0.8,0,Math.PI*2); ctx.fill();
    }
    ctx.globalCompositeOperation='source-over';
  }

  // === Neon1: organic curves ===
  PFN.cvNeon = function() {
    var sk=[], cols=['255,20,100','0,180,255','255,245,200'];
    for(var i=0;i<3;i++){sk.push({x:200+(i-1)*100,y:112,px:0,py:0,angle:i*2.1,curv:0,spd:0.9,seed:42+i*137,col:cols[i]});sk[i].px=sk[i].x;sk[i].py=sk[i].y}
    neonTrails('cvNeon',sk,function(s,t,W,H){
      var n1=snoise(s.seed,t*0.06)-0.5; s.curv+=(n1*0.05-s.curv)*0.03; s.angle+=s.curv;
      s.x+=Math.cos(s.angle)*s.spd; s.y+=Math.sin(s.angle)*s.spd; edgeSteer(s,W,H,0.8);
    },150);
  };

  // === Neon2: triangle turns ===
  PFN.cvNeon2 = function() {
    var TTP=2.0943951, sk=[];
    for(var i=0;i<3;i++){sk.push({x:133+i*67,y:112,px:0,py:0,angle:i*1.05,spd:0.9,seed:42+i*137,col:rndNeon(),segDist:0,segLen:30+Math.random()*40,turnDir:Math.random()<0.5?1:-1,turning:0});sk[i].px=sk[i].x;sk[i].py=sk[i].y}
    neonTrails('cvNeon2',sk,function(s,t,W,H){
      s.angle+=(snoise(s.seed,t*0.08)-0.5)*0.012;
      if(s.turning>0){var step=Math.min(0.12,s.turning);s.angle+=step*s.turnDir;s.turning-=step}
      else{s.segDist+=s.spd;if(s.segDist>=s.segLen){s.segDist=0;s.segLen=30+snoise(s.seed+300,t*0.05)*50;s.turning=TTP+(snoise(s.seed+400,t*0.1)-0.5)*0.7;if(snoise(s.seed+500,t*0.03)>0.7)s.turnDir*=-1}}
      s.x+=Math.cos(s.angle)*s.spd;s.y+=Math.sin(s.angle)*s.spd;
      if(edgeSteer(s,W,H,0.8)){s.turning=0;s.segDist=0;s.segLen=30+Math.random()*40}
    },150);
  };

  // === Neon3: shape cycling (circle/triangle/square physics) ===
  PFN.cvNeon3 = function() {
    var TT=2.0943951, sk=[], cols3=['255,40,80','20,100,255','255,240,180'], shapes=['circle','triangle','square'];
    for(var i=0;i<3;i++){sk.push({x:133+i*67,y:112,px:0,py:0,angle:i*2.1,curv:0,spd:0.9,seed:42+i*95,col:cols3[i],shape:shapes[i],segDist:0,segLen:30+Math.random()*40,turnDir:Math.random()<0.5?1:-1,turning:0});sk[i].px=sk[i].x;sk[i].py=sk[i].y}
    neonTrails('cvNeon3',sk,function(s,t,W,H){
      if(s.shape==='circle'){var n1=snoise(s.seed,t*0.04)-0.5;s.curv+=(0.03*s.turnDir+n1*0.02-s.curv)*0.04;s.angle+=s.curv;s.angle+=(snoise(s.seed+99,t*0.008)-0.5)*0.012}
      else{var ta=s.shape==='triangle'?TT:Math.PI/2;s.angle+=(snoise(s.seed,t*0.08)-0.5)*0.012;if(s.turning>0){var step=Math.min(0.12,s.turning);s.angle+=step*s.turnDir;s.turning-=step}else{s.segDist+=s.spd;if(s.segDist>=s.segLen){s.segDist=0;s.segLen=30+snoise(s.seed+300,t*0.05)*50;s.turning=ta+(snoise(s.seed+400,t*0.1)-0.5)*0.5;if(snoise(s.seed+500,t*0.03)>0.7)s.turnDir*=-1}}}
      s.x+=Math.cos(s.angle)*s.spd;s.y+=Math.sin(s.angle)*s.spd;
      if(s.shape==='circle'){var ex=Math.abs(s.x-W/2)/(W/2),ey=Math.abs(s.y-H/2)/(H/2),edge=Math.max(ex,ey);var da=Math.atan2(H/2-s.y,W/2-s.x)-s.angle;while(da>Math.PI)da-=Math.PI*2;while(da<-Math.PI)da+=Math.PI*2;s.angle+=da*edge*edge*0.06;s.curv*=(1-edge*edge*0.15)}
      else if(edgeSteer(s,W,H,0.8)){s.turning=0;s.segDist=0;s.segLen=30+Math.random()*40}
    },150);
  };

  // === Neon4: grid 90-degree turns ===
  PFN.cvNeon4 = function() {
    var sk=[], c4=[rndNeon(),rndNeon(),rndNeon()];
    for(var i=0;i<5;i++){sk.push({x:80+i*60,y:112,px:0,py:0,angle:i*1.25,spd:0.85+i*0.04,seed:42+i*95,col:c4[i%3],segDist:0,segLen:30+Math.random()*40,turnDir:Math.random()<0.5?1:-1,turning:0});sk[i].px=sk[i].x;sk[i].py=sk[i].y}
    neonTrails('cvNeon4',sk,function(s,t,W,H){
      s.angle+=(snoise(s.seed,t*0.08)-0.5)*0.012;
      if(s.turning>0){var step=Math.min(0.12,s.turning);s.angle+=step*s.turnDir;s.turning-=step}
      else{s.segDist+=s.spd;if(s.segDist>=s.segLen){s.segDist=0;s.segLen=30+snoise(s.seed+300,t*0.05)*50;s.turning=Math.PI/2+(snoise(s.seed+400,t*0.1)-0.5)*0.5;if(snoise(s.seed+500,t*0.03)>0.7)s.turnDir*=-1}}
      s.x+=Math.cos(s.angle)*s.spd;s.y+=Math.sin(s.angle)*s.spd;
      if(edgeSteer(s,W,H,0.8)){s.turning=0;s.segDist=0;s.segLen=30+Math.random()*40}
    },120);
  };

  // === Neon5: wave trajectory ===
  PFN.cvNeon5 = function() {
    var sk=[], c5=['255,40,80','20,100,255','255,240,180'], types=['sin','cos','sin2'];
    function wv(tp,ph){return tp==='sin'?Math.sin(ph):tp==='cos'?Math.cos(ph):Math.sin(ph*2)}
    for(var i=0;i<3;i++){var ba=Math.random()*Math.PI*2;sk.push({x:133+i*67,y:112,px:0,py:0,baseX:133+i*67,baseY:112,baseAngle:ba,phase:Math.random()*Math.PI*2,angle:0,spd:0.9,seed:42+i*95,col:c5[i],waveType:types[i]});sk[i].px=sk[i].x;sk[i].py=sk[i].y}
    neonTrails('cvNeon5',sk,function(s,t,W,H){
      s.baseAngle+=(snoise(s.seed,t*0.03)-0.5)*0.008; s.phase+=s.spd*0.015;
      s.baseX+=Math.cos(s.baseAngle)*s.spd; s.baseY+=Math.sin(s.baseAngle)*s.spd;
      var perp=s.baseAngle+Math.PI/2, lat=100*wv(s.waveType,s.phase);
      s.x=s.baseX+Math.cos(perp)*lat; s.y=s.baseY+Math.sin(perp)*lat;
      var mg=105;
      if(s.baseX<-mg){var sh=W+2*mg;s.baseX+=sh;s.x+=sh;s.px=s.x;s.py=s.y}
      else if(s.baseX>W+mg){var sh=W+2*mg;s.baseX-=sh;s.x-=sh;s.px=s.x;s.py=s.y}
      if(s.baseY<-mg){var sh=H+2*mg;s.baseY+=sh;s.y+=sh;s.px=s.x;s.py=s.y}
      else if(s.baseY>H+mg){var sh=H+2*mg;s.baseY-=sh;s.y-=sh;s.px=s.x;s.py=s.y}
    },180);
  };

  // === Neon6: Kepler orbital ===
  PFN.cvNeon6 = function() {
    var PRESETS={circular:{a:0.55,e:0.05,period:900},elliptical:{a:0.40,e:0.50,period:700},comet:{a:0.60,e:0.80,period:1100}};
    function kepler(M,e){var E=M;for(var i=0;i<10;i++){var dE=(E-e*Math.sin(E)-M)/(1-e*Math.cos(E));E-=dE;if(Math.abs(dE)<1e-8)break}return E}
    function orbPos(s,W,H){var p=PRESETS[s.oType],sc=Math.min(W,H)*0.5,a=p.a*sc,e=p.e,b=a*Math.sqrt(1-e*e);var M=(s.phase+s.orbitTime*Math.PI*2/p.period)%(Math.PI*2);var E=kepler(M,e),ox=a*(Math.cos(E)-e),oy=b*Math.sin(E);var ct=Math.cos(s.tilt),st=Math.sin(s.tilt);return{x:W*0.5+(ox*ct-oy*st),y:H*0.5+(ox*st+oy*ct)}}
    var sk=[], c6=['255,40,80','20,100,255','255,240,180'], t6=['circular','elliptical','comet'], tilts=[0,Math.PI*2*0.33,Math.PI*2*0.67];
    for(var i=0;i<3;i++){var s={oType:t6[i],phase:Math.random()*Math.PI*2,tilt:tilts[i]+(Math.random()-0.5)*0.6,orbitTime:0,precession:(Math.random()-0.5)*0.0006,x:0,y:0,px:0,py:0,angle:0,spd:1,seed:i,col:c6[i]};var pos=orbPos(s,400,225);s.x=pos.x;s.y=pos.y;s.px=pos.x;s.py=pos.y;sk.push(s)}
    neonTrails('cvNeon6',sk,function(s,t,W,H){s.orbitTime++;s.tilt+=s.precession;var pos=orbPos(s,W,H);s.x=pos.x;s.y=pos.y},200);
  };
  </script>
</body>
</html>
